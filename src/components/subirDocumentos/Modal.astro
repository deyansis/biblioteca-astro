<div x-data="newcarrera">
    <!-- Button to open the modal -->
    <button
        @click="showModal = true"
        type="button"
        class="w-full mt-5 px-4 py-2 text-sm font-medium text-white bg-biblio-secundary border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-biblio-secundary"
    >
        Agregar Carrera
    </button>
    <!-- Background overlay -->
    <div
        x-show="showModal"
        class="fixed inset-0 transition-opacity"
        aria-hidden="true"
        @click="showModal = false"
    >
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>
    <!-- Modal -->
    <div
        x-show="showModal"
        x-transition:enter="transition ease-out duration-300 transform"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave="transition ease-in duration-200 transform"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        class="fixed z-10 inset-0 overflow-y-auto mt-20"
        x-cloak
    >
        <div
            class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
        >
            <!-- Modal panel -->
            <div
                class="w-full inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
                role="dialog"
                aria-modal="true"
                aria-labelledby="modal-headline"
            >
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <!-- Modal content -->
                    <div class="flex flex-col gap-4">
                        <h1>Agregar Carrera</h1>

                        <div class="relative">
                            <div
                                class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="w-5 h-5 text-gray-500 dark:text-gray-400"
                                    viewBox="0 0 15 15"
                                    ><path
                                        fill="currentColor"
                                        d="M7.5 1L0 4.5l2 .9v1.7c-.6.2-1 .8-1 1.4s.4 1.2 1 1.4v.1l-.9 2.1C.8 13 1 14 2.5 14s1.7-1 1.4-1.9L3 10c.6-.3 1-.8 1-1.5s-.4-1.2-1-1.4V5.9L7.5 8L15 4.5zm4.4 6.5l-4.5 2L5 8.4v.1c0 .7-.3 1.3-.8 1.8l.6 1.4v.1c.1.4.2.8.1 1.2c.7.3 1.5.5 2.5.5c3.3 0 4.5-2 4.5-3z"
                                    ></path></svg
                                >
                            </div>
                            <input
                                type="text"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5"
                                placeholder="Ingenieria de ...."
                                x-model="carrera_new"
                            />
                        </div>
                    </div>
                </div>
                <div
                    class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"
                >
                    <button
                        @click="showModal = false"
                        type="button"
                        class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-200 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
                    >
                        Cancel
                    </button>
                    <button
                        @click="addNewCarrera"
                        type="button"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-biblio-primary text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bibg-biblio-primary sm:ml-3 sm:w-auto sm:text-sm"
                    >
                        Agregar Carrera
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    import Alpine from "alpinejs";
    import { navigate } from "astro:transitions/client";

    document.addEventListener("alpine:init", () => {
        Alpine.data("newcarrera", () => ({
            showModal: false,
            carrera_new: "",

            async addNewCarrera(e: MouseEvent) {
                e.preventDefault();

                const response = await fetch(
                    `http://localhost:9000/carrera/create`,
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            carrera: this.carrera_new,
                        }),
                    },
                )
                    .then(() => {
                        this.showModal = false;
                        navigate("/subirDocumentos");
                    })
                    .catch((err) => console.error(err));
            },

        }));
    });
</script>
